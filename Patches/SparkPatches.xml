<?xml version="1.0" encoding="utf-8"?>

<Patch>
  <!-- Add an empty prerequisites tag to all projects lacking one -->
  <Operation Class="PatchOperationAdd">
    <xpath>/Defs/ResearchProjectDef[not(prerequisites)]</xpath>
    <value>
      <prerequisites/>
    </value>
  </Operation>

  <!-- Add spark prerequisites tag to all projects lacking any prerequisites -->
  <Operation Class="PatchOperationAdd">
    <xpath>/Defs/ResearchProjectDef[techLevel = "Neolithic" and defName != "CAT_NeolithicSpark"]/prerequisites[count(li) = 0]</xpath>
    <value>
      <li>CAT_NeolithicSpark</li>
    </value>
  </Operation>

  <Operation Class="PatchOperationAdd">
    <xpath>/Defs/ResearchProjectDef[techLevel = "Medieval" and defName != "CAT_MedievalSpark"]/prerequisites[count(li) = 0]</xpath>
    <value>
      <li>CAT_MedievalSpark</li>
    </value>
  </Operation>

  <Operation Class="PatchOperationAdd">
    <xpath>/Defs/ResearchProjectDef[techLevel = "Industrial" and defName != "CAT_IndustrialSpark"]/prerequisites[count(li) = 0]</xpath>
    <value>
      <li>CAT_IndustrialSpark</li>
    </value>
  </Operation>

  <Operation Class="PatchOperationAdd">
    <xpath>/Defs/ResearchProjectDef[techLevel = "Spacer" and defName != "CAT_SpacerSpark"]/prerequisites[count(li) = 0]</xpath>
    <value>
      <li>CAT_SpacerSpark</li>
    </value>
  </Operation>

  <Operation Class="PatchOperationAdd">
    <xpath>/Defs/ResearchProjectDef[techLevel = "Ultra" and defName != "CAT_UltraSpark"]/prerequisites[count(li) = 0]</xpath>
    <value>
      <li>CAT_UltraSpark</li>
    </value>
  </Operation>

  <Operation Class="PatchOperationAdd">
    <xpath>/Defs/ResearchProjectDef[techLevel = "Archotech" and defName != "CAT_ArchotechSpark"]/prerequisites[count(li) = 0]</xpath>
    <value>
      <li>CAT_ArchotechSpark</li>
    </value>
  </Operation>

</Patch>
